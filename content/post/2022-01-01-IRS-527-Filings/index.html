---
title: "IRS 527 Filings"
author: "Isaac Flath"
categories: ["Politics"]
tags: ["IRS", "527 Orgs"]
date: 2022-02-01T21:13:14-05:00
output:
  html_document:
    number_sections: false
    fig_caption: true
    toc: true
    toc_float: true
    fig_width: 7
    fig_height: 4.5
    theme: cosmo
    highlight: tango
    code_folding: hide
---

<script src="{{< blogdown/postref >}}index_files/header-attrs/header-attrs.js"></script>


<style type="text/css">
#header {
    background-image: linear-gradient(120deg, lightblue, blue);
}
.title.toc-ignore {
  font-weight: 1000;
}
h1{
    background-image: linear-gradient(120deg, lightblue, blue);
}
</style>
<div id="setup" class="section level1 tabset tabset-fade tabset-pills">
<h1>Setup</h1>
<div id="imports" class="section level2">
<h2>Imports</h2>
<p>These are all standard imports that I use. I havenâ€™t filtered out ones not used in this particular report, but these are my standard imports I start with on projects.</p>
<pre class="r"><code>library(DBI)

# general visualisation
library(&#39;ggplot2&#39;) # visualisation
library(&#39;scales&#39;) # visualisation
library(&#39;patchwork&#39;) # visualisation
library(&#39;RColorBrewer&#39;) # visualisation
library(&#39;corrplot&#39;) # visualisation
library(&#39;ggthemes&#39;) # visualisation
library(&#39;viridis&#39;) # visualisation
library(&#39;gt&#39;) # table styling

# general data manipulation
library(&#39;dplyr&#39;) # data manipulation
library(&#39;readr&#39;) # input/output
library(&#39;vroom&#39;) # input/output
library(&#39;tibble&#39;) # data wrangling
library(&#39;tidyr&#39;) # data wrangling
library(&#39;stringr&#39;) # string manipulation
library(&#39;forcats&#39;) # factor manipulation
library(&#39;janitor&#39;) # cleaning

# specific
library(&#39;glue&#39;) # encoding
library(&#39;naniar&#39;) # missing values
#library(&#39;gganimate&#39;) # visualisation
library(&#39;ggrepel&#39;) # visualisation
library(&#39;grid&#39;) # visualisation
library(&#39;GGally&#39;) # visualisation
library(&#39;ggforce&#39;) # visualisation
#library(&#39;ggtext&#39;) # visualisation</code></pre>
</div>
<div id="udfs" class="section level2">
<h2>UDFs</h2>
<pre class="r"><code>`%notin%` &lt;- Negate(`%in%`)</code></pre>
</div>
<div id="download-and-unzip" class="section level2">
<h2>Download and Unzip</h2>
<p>The Data is availabe from the IRS website at this location <code>http://forms.irs.gov/app/pod/dataDownload/fullData</code>.</p>
<p>We need to download, unzip, and then pull the file out of the nested directory path.</p>
<p>Download and unzip the file to <code>FullDataFile.txt</code></p>
<pre class="r"><code>output_path &lt;- &quot;~/code_outputs&quot;
url = &#39;http://forms.irs.gov/app/pod/dataDownload/fullData&#39;

dest_path = file.path(output_path,&quot;irs527_fullData.zip&quot;)
if (!file.exists(dest_path)) {download.file(url,dest_path)}

unzip_path = file.path(output_path,&quot;var&quot;)
if (!file.exists(unzip_path)){unzip(dest_path)}

from = file.path(output_path,&quot;/var/IRS/data/scripts/pofd/download/FullDataFile.txt&quot;)
file_path = file.path(output_path,&quot;FullDataFile.txt&quot;)
file.copy(from,file_path)</code></pre>
</div>
<div id="file-head" class="section level2">
<h2>File Head</h2>
<p>From there we can look at the first few lines of the file. We can see a few things:</p>
<ol style="list-style-type: decimal">
<li>Not every row has the same number of fields.</li>
<li>The first cell has what type of row it is</li>
</ol>
<p>This tells us that we are probably going to need to parse this row by row in some way, rather than using an out of the box read csv function.</p>
<pre class="r"><code>lines &lt;- readLines(file_path, n=7)
writeLines(lines,sep=&quot;\n\n&quot;)</code></pre>
<pre><code>H|20220129|0311|F|

1|8871|8|0|0|0|912121950|Dan Swecker for Senate Campaign|10420 - 173rd Ave SW||Rochester|WA|98579||wfga@localaccess.com||Dan Swecker|10420 - 173rd Ave SW||Rochester|WA|98579||Dan Swecker|10420 - 173rd Ave. SW||Rochester|WA|98579||same||Rochester|WA|98579|||||Tax exempt political organization - Political campaign||2001-05-13 21:20:54|0|1

D|8|26174|Dan Swecker for Senate Campaign|912121950|Dan Swecker|Candidate|10420 - 173rd Ave. SW||Rochester|WA|98579||

1|8871|9|0|0|0|954857244|FRIENDS OF TOM CALDERON|728 W. EDNA PLACE||COVINA|CA|91722||no@email||YOLANDA MIRANDA|728 W. EDNA PLACE||COVINA|CA|91722||YOLANDA MIRANDA|728 W. EDNA PLACE||COVINA|CA|91722||728 W. EDNA PLACE||COVINA|CA|91722|||||RAISE FUNDS TO ELECT CANDIDATE||2001-05-14 15:05:31|1|1

D|9|269|FRIENDS OF TOM CALDERON|954857244|THOMAS M. CALDERON|CANDIDATE|412 N. 10TH STREET||MONTEBELLO|CA|90640||

D|9|270|FRIENDS OF TOM CALDERON|954857244|YOLANDA MIRAND|TREASURER|728 W. EDNA PLACE||COVINA|CA|91722||

1|8871|10|0|0|0|061596525|ASGM PAC|WILLIAM S WEBB CO INC|377 OAK ST - CS601|GARDEN CITY|NY|11530|0601|no@email||RICHARD C BLIVEN|377 OAK ST - CS601||GARDEN CITY|NY|11530|0601|RICHARD C BLIVEN|377 OAK ST - CS601||GARDEN CITY|NY|11530|0601|WILLIAM S WEBB CO INC|377 OAK ST - CS601|GARDEN CITY|NY|11530|0601||||POLITICAL ACTION COMMITTEE TO PROMOTE LEGISLATION FAVORABLE TO WORKERS COMPENSATION SAFETY GROUPS IN NEW YORK STATE.||2001-05-14 17:24:52|1|1</code></pre>
</div>
</div>
<div id="structure-data" class="section level1 tabset tabset-fade tabset-pills">
<h1>Structure Data</h1>
<p>The structure of the file has different types of data indicated by the first letter of each row. In order to read this, we need to break it out into each files. There are several ways to do this</p>
<p>We additionally need to account for multi-line rows, where an individual row can span multiple lines.</p>
<div id="split-files" class="section level2">
<h2>Split Files</h2>
<p>First we split the file based on the first column. The idea is to take each line and drop it into another file, but there are some complications that we need to handle.</p>
<p>First, what would normally be a row in a dataframe is sometimes split among several lines. Because of this we cannot simply look row by row. To handle this we concatenate lines together while removing line breaks, and when we get to a new record start we dump it to the appropriate file.</p>
<pre class="r"><code>nlines &lt;- read.table(pipe(paste(&quot;wc -l&quot;,file_path)))[[1]]

line_starts &lt;- list(&#39;H|&#39;,&#39;F|&#39;,&#39;1|&#39;,&#39;2|&#39;,&#39;A|&#39;,&#39;B|&#39;,&#39;D|&#39;,&#39;E|&#39;,&#39;R|&#39;)

# open output files
out_files &lt;- list()
for(line in line_starts){
  fpath &lt;- file.path(output_path,paste(line,&#39;.txt&#39;))
  if (file.exists(fpath)) {
    print(paste(&quot;File Already Exists:&quot;,fpath))
    next
    } else {
    out_files[[line]] &lt;- file(fpath,&#39;w&#39;)
    }
}</code></pre>
<pre><code>## [1] &quot;File Already Exists: ~/code_outputs/H| .txt&quot;
## [1] &quot;File Already Exists: ~/code_outputs/F| .txt&quot;
## [1] &quot;File Already Exists: ~/code_outputs/1| .txt&quot;
## [1] &quot;File Already Exists: ~/code_outputs/2| .txt&quot;
## [1] &quot;File Already Exists: ~/code_outputs/A| .txt&quot;
## [1] &quot;File Already Exists: ~/code_outputs/B| .txt&quot;
## [1] &quot;File Already Exists: ~/code_outputs/D| .txt&quot;
## [1] &quot;File Already Exists: ~/code_outputs/E| .txt&quot;
## [1] &quot;File Already Exists: ~/code_outputs/R| .txt&quot;</code></pre>
<pre class="r"><code>if(length(out_files) &gt; 0){
  
  con &lt;- file(file_path,&quot;r&quot;)
  
  for(i in 0:nlines) {
    line &lt;- str_replace_all(str_replace_all(readLines(con, n = 1), &#39;\r&#39;, &#39;&#39;), &#39;\n&#39;, &#39;&#39;)
  
    if(identical(line,character(0))){
      writeLines(full_line, out_files[[out_type]])
      break}
  
    line_type &lt;- substr(line,1,2)
  
    # handle starting line
    if(i==0){
      full_line &lt;- line
      out_type &lt;- line_type
      next
    }
  
    if(line_type %in% line_starts){
      if(out_type %in% names(out_files)){writeLines(full_line, out_files[[out_type]])}
      full_line &lt;- line
      out_type &lt;- line_type
    } else {
      full_line &lt;- paste(full_line,line)
    }
    if(i%%100000 == 0){print(paste(Sys.time(),&#39;|&#39;,i,&#39;of&#39;,nlines))}
  }
  # close all files
  close(con)
  for (f in out_files) {close(f)}
}</code></pre>
</div>
<div id="column-map" class="section level2">
<h2>Column Map</h2>
<p>When we load into the dataframe we need to give them column names to be useful. Because of how the files are structured, it does not include a header with column names so we need to take them from the data dictionary the provide.</p>
<pre class="r"><code>a &lt;- c(&#39;record_type&#39;,&#39;form_id_number&#39;,&#39;sched_a_id&#39;,&#39;org_name&#39;,&#39;ein&#39;,&#39;contributor_name&#39;,&#39;contributor_address_1&#39;,
        &#39;contributor_address_2&#39;,&#39;contributor_address_city&#39;,&#39;contributor_address_state&#39;,&#39;contributor_address_zip_code&#39;,
        &#39;contributor_address_zip_ext&#39;,&#39;contributor_employer&#39;,&#39;contribution_amount&#39;,&#39;contributor_occupation&#39;,
        &#39;agg_contribution_ytd&#39;,&#39;contribution_date&#39;)

one &lt;- c(&#39;record_type&#39;,&#39;form_type&#39;,&#39;form_id_number&#39;,&#39;initial_report_indicator&#39;,&#39;amended_report_indicator&#39;,&#39;final_report_indicator&#39;,&#39;ein&#39;,
        &#39;organization_name&#39;,&#39;mailing_address_1&#39;,&#39;mailing_address_2&#39;,&#39;mailing_address_city&#39;,&#39;mailing_address_state&#39;,&#39;mailing_address_zip_code&#39;,
        &#39;mailing_address_zip_ext&#39;,&#39;e_mail_address&#39;,&#39;established_date&#39;,&#39;custodian_name&#39;,&#39;custodian_address_1&#39;,&#39;custodian_address_2&#39;,
        &#39;custodian_address_city&#39;,&#39;custodian_address_state&#39;,&#39;custodian_address_zip_code&#39;,&#39;custodian_address_zip_ext&#39;,&#39;contact_person_name&#39;,
        &#39;contact_address_1&#39;,&#39;contact_address_2&#39;,&#39;contact_address_city&#39;,&#39;contact_address_state&#39;,&#39;contact_address_zip_code&#39;,&#39;contact_address_zip_ext&#39;,
        &#39;business_address_1&#39;,&#39;business_address_2&#39;,&#39;business_address_city&#39;,&#39;business_address_state&#39;,&#39;business_address_zip_code&#39;,&#39;business_address_zip_ext&#39;,
        &#39;exempt_8872_indicator&#39;,&#39;exempt_state&#39;,&#39;exempt_990_indicator&#39;,&#39;purpose&#39;,&#39;material_change_date&#39;,&#39;insert_datetime&#39;,&#39;related_entity_bypass&#39;,
        &#39;eain_bypass&#39;)

two &lt;- c(&#39;record_type&#39;,&#39;form_type&#39;,&#39;form_id_number&#39;,&#39;period_begin_date&#39;,&#39;period_end_date&#39;,&#39;initial_report_indicator&#39;,&#39;amended_report_indicator&#39;,&#39;final_report_indicator&#39;,
          &#39;change_of_address_indicator&#39;,&#39;organization_name&#39;,&#39;ein&#39;,&#39;mailing_address_1&#39;,&#39;mailing_address_2&#39;,&#39;mailing_address_city&#39;,&#39;mailing_address_state&#39;,&#39;mailing_address_zip_code&#39;,
          &#39;mailing_address_zip_ext&#39;,&#39;e_mail_address&#39;,&#39;org_formation_date&#39;,&#39;custodian_name&#39;,&#39;custodian_address_1&#39;,&#39;custodian_address_2&#39;,&#39;custodian_address_city&#39;,&#39;custodian_address_state&#39;,
          &#39;custodian_address_zip_code&#39;,&#39;custodian_address_zip_ext&#39;,&#39;contact_person_name&#39;,&#39;contact_address_1&#39;,&#39;contact_address_2&#39;,&#39;contact_address_city&#39;,&#39;contact_address_state&#39;,
          &#39;contact_address_zip_code&#39;,&#39;contact_address_zip_ext&#39;,&#39;business_address_1&#39;,&#39;business_address_2&#39;,&#39;business_address_city&#39;,&#39;business_address_state&#39;,&#39;business_address_zip_code&#39;,
          &#39;business_address_zip_ext&#39;,&#39;qtr_indicator&#39;,&#39;monthly_rpt_month&#39;,&#39;pre_elect_type&#39;,&#39;pre_or_post_elect_date&#39;,&#39;pre_or_post_elect_state&#39;,&#39;sched_a_ind&#39;,&#39;total_sched_a&#39;,
          &#39;sched_b_ind&#39;,&#39;total_sched_b&#39;,&#39;insert_datetime&#39;)

b &lt;- c(&#39;record_type&#39;,&#39;form_id_number&#39;,&#39;sched_b_id&#39;,&#39;org_name&#39;,&#39;ein&#39;,&#39;reciepient_name&#39;,&#39;reciepient_address_1&#39;,&#39;reciepient_address_2&#39;,&#39;reciepient_address_city&#39;,&#39;reciepient_address_st&#39;,
      &#39;reciepient_address_zip_code&#39;,&#39;reciepient_address_zip_ext&#39;,&#39;reciepient_employer&#39;,&#39;expenditure_amount&#39;,&#39;recipient_occupation&#39;,&#39;expenditure_date&#39;,&#39;expenditure_purpose&#39;)

d &lt;- c(&#39;record_type&#39;,&#39;form_id_number&#39;,&#39;director_id&#39;,&#39;org_name&#39;,&#39;ein&#39;,&#39;entity_name&#39;,&#39;entity_title&#39;,&#39;entity_address_1&#39;,&#39;entity_address_2&#39;,&#39;entity_address_city&#39;,
        &#39;entity_address_st&#39;,&#39;entity_address_zip_code&#39;,&#39;entity_address_zip_code_ext&#39;)

e &lt;- c(&#39;record_type&#39;,&#39;form_id_number&#39;,&#39;eain_id&#39;,&#39;election_authority_id_number&#39;,&#39;state_issued&#39;)

r &lt;- c(&#39;record_type&#39;,&#39;form_id_number&#39;,&#39;entity_id&#39;,&#39;org_name&#39;,&#39;ein&#39;,&#39;entity_name&#39;,&#39;entity_relationship&#39;,&#39;entity_address_1&#39;,&#39;entity_address_2&#39;,&#39;entity_address_city&#39;,
      &#39;entity_address_st&#39;,&#39;entity_address_zip_code&#39;,&#39;entity_address_zip_ext&#39;)

h &lt;- c(&#39;record_type&#39;,&#39;transmission_date&#39;,&#39;transmission_time&#39;,&#39;file_id_modifier&#39;)
f &lt;- c(&#39;record_type&#39;,&#39;transmission_date&#39;,&#39;transmission_time&#39;,&#39;record_count&#39;)

column_map &lt;- list(&#39;H|&#39;=h,
                   &#39;F|&#39;=f,
                   &#39;1|&#39;=one,
                   &#39;2|&#39;=two,
                   &#39;A|&#39;=a,
                   &#39;B|&#39;=b,
                   &#39;D|&#39;=d,
                   &#39;E|&#39;=e,
                   &#39;R|&#39;=r)         </code></pre>
</div>
</div>
<div id="load-files" class="section level1 tabset tabset-fade tabset-pills">
<h1>Load Files</h1>
<p>Now that we have our files split out we can handle them like normal csv files and load them into SQLite. Letâ€™s start with loading all our data into a sqlite database and take a brief look at some of the data we have.</p>
<p>After that we will walk through each one and take a quick look at whatâ€™s there and a few fields that peaked my interest at first glanse, though wonâ€™t explore every field or go in a ton of depth</p>
<pre class="r"><code>con &lt;- dbConnect(RSQLite::SQLite(), file.path(output_path,&quot;irs.sqlite&quot;))
tables &lt;- dbListTables(con)</code></pre>
<pre class="r"><code>load_map &lt;- list(&quot;1|&quot;=&quot;main_8871&quot;,
                 &#39;D|&#39;=&quot;directors_officers_8871&quot;,
                 &#39;R|&#39;=&quot;related_entities_8871&quot;,
                 &#39;E|&#39;=&quot;eain_8871&quot;,
                 &quot;2|&quot;=&quot;main_8872&quot;,
                 &quot;A|&quot;=&quot;schedule_a_8872&quot;,
                 &quot;B|&quot;=&quot;schedule_b_8872&quot;)

for(file_pref in names(load_map)){
  table_name &lt;- load_map[[file_pref]]
  if(table_name %notin% tables){
    print(paste(&quot;Loading&quot;,file_pref,&quot;into&quot;,table_name))
    df &lt;- vroom(file.path(output_path,paste(file_pref,&quot;.txt&quot;)),col_names=column_map[[file_pref]])
    dbWriteTable(con, table_name, df, overwrite=TRUE)
  }
}

dbListTables(con)</code></pre>
<div id="file-metadata" class="section level2 tabset tabset-fade tabset-pills">
<h2>File Metadata</h2>
<p>Each file has a header and footer row.</p>
<div id="header-row" class="section level3">
<h3>Header Row</h3>
<p>The file starts with a header row that just have general data about this particular data file.</p>
<pre class="r"><code>file_pref &lt;- &#39;H|&#39;
df &lt;- vroom(file.path(output_path,paste(file_pref,&quot;.txt&quot;)),col_names=column_map[[file_pref]],n_max=1000)
gt(df %&gt;% select(-X5))</code></pre>
<div id="zjwreywnkh" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#zjwreywnkh .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#zjwreywnkh .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#zjwreywnkh .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#zjwreywnkh .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#zjwreywnkh .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#zjwreywnkh .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#zjwreywnkh .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#zjwreywnkh .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#zjwreywnkh .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#zjwreywnkh .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#zjwreywnkh .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#zjwreywnkh .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#zjwreywnkh .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#zjwreywnkh .gt_from_md > :first-child {
  margin-top: 0;
}

#zjwreywnkh .gt_from_md > :last-child {
  margin-bottom: 0;
}

#zjwreywnkh .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#zjwreywnkh .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#zjwreywnkh .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#zjwreywnkh .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#zjwreywnkh .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#zjwreywnkh .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#zjwreywnkh .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#zjwreywnkh .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#zjwreywnkh .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#zjwreywnkh .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#zjwreywnkh .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#zjwreywnkh .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#zjwreywnkh .gt_left {
  text-align: left;
}

#zjwreywnkh .gt_center {
  text-align: center;
}

#zjwreywnkh .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#zjwreywnkh .gt_font_normal {
  font-weight: normal;
}

#zjwreywnkh .gt_font_bold {
  font-weight: bold;
}

#zjwreywnkh .gt_font_italic {
  font-style: italic;
}

#zjwreywnkh .gt_super {
  font-size: 65%;
}

#zjwreywnkh .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">record_type</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">transmission_date</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">transmission_time</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">file_id_modifier</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">H</td>
<td class="gt_row gt_right">20220129</td>
<td class="gt_row gt_left">0311</td>
<td class="gt_row gt_center">FALSE</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
<div id="footer-row" class="section level3">
<h3>Footer Row</h3>
<p>The files end with a fooder record that has data about the particular file, similar to the header.</p>
<pre class="r"><code>file_pref &lt;- &#39;F|&#39;
df &lt;- vroom(file.path(output_path,paste(file_pref,&quot;.txt&quot;)),col_names=column_map[[file_pref]],n_max=1000)
gt(df %&gt;% select(-X5))</code></pre>
<div id="tbzpfzubgc" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#tbzpfzubgc .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#tbzpfzubgc .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#tbzpfzubgc .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#tbzpfzubgc .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#tbzpfzubgc .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#tbzpfzubgc .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#tbzpfzubgc .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#tbzpfzubgc .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#tbzpfzubgc .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#tbzpfzubgc .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#tbzpfzubgc .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#tbzpfzubgc .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#tbzpfzubgc .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#tbzpfzubgc .gt_from_md > :first-child {
  margin-top: 0;
}

#tbzpfzubgc .gt_from_md > :last-child {
  margin-bottom: 0;
}

#tbzpfzubgc .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#tbzpfzubgc .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#tbzpfzubgc .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#tbzpfzubgc .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#tbzpfzubgc .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#tbzpfzubgc .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#tbzpfzubgc .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#tbzpfzubgc .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#tbzpfzubgc .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#tbzpfzubgc .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#tbzpfzubgc .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#tbzpfzubgc .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#tbzpfzubgc .gt_left {
  text-align: left;
}

#tbzpfzubgc .gt_center {
  text-align: center;
}

#tbzpfzubgc .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#tbzpfzubgc .gt_font_normal {
  font-weight: normal;
}

#tbzpfzubgc .gt_font_bold {
  font-weight: bold;
}

#tbzpfzubgc .gt_font_italic {
  font-style: italic;
}

#tbzpfzubgc .gt_super {
  font-size: 65%;
}

#tbzpfzubgc .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">record_type</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">transmission_date</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">transmission_time</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">record_count</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">F|20220129|0322|8786886|</td>
<td class="gt_row gt_left">(return</td>
<td class="gt_row gt_left">status</td>
<td class="gt_row gt_left">=</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
<div id="data" class="section level2 tabset tabset-fade tabset-pills">
<h2>8871 Data</h2>
<div id="main-form" class="section level3">
<h3>8871 Main Form</h3>
<p>The 8871 form is where 527 organizations submit data about their company. In this header form we see a lot of basic information you would expect on any company record such as addresses, contact information, purpose, and ID numbers.</p>
<pre class="r"><code>df &lt;- dbGetQuery(con, &#39;SELECT * FROM main_8871&#39;)

df &lt;- df %&gt;%
  mutate(across(c(exempt_state, business_address_state,contact_address_state,custodian_address_state,mailing_address_state,established_date), as.factor))
# %&gt;%
#   mutate(across(c(initial_report_indicator, amended_report_indicator,final_report_indicator,
#                   exempt_8872_indicator,related_entity_bypass,eain_bypass), as.logical))</code></pre>
<pre class="r"><code>df %&gt;% 
  sample_frac(0.2) %&gt;% 
  naniar::vis_miss()</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-8-1.png" width="100%" /></p>
<pre class="r"><code>p1 &lt;- df %&gt;% 
  filter(!is.na(initial_report_indicator)) %&gt;% 
  count(initial_report_indicator) %&gt;% 
  ggplot(aes(initial_report_indicator, n, fill = initial_report_indicator)) +
  geom_col() +
  theme_minimal() +
  theme(legend.position = &quot;none&quot;) +
  labs(x = &quot;&quot;, title = &quot;Initial Report Indicator&quot;)
p2 &lt;- df %&gt;% 
  filter(!is.na(amended_report_indicator)) %&gt;% 
  count(amended_report_indicator) %&gt;% 
  ggplot(aes(amended_report_indicator, n, fill = amended_report_indicator)) +
  geom_col() +
  theme_minimal() +
  theme(legend.position = &quot;none&quot;) +
  labs(x = &quot;&quot;, title = &quot;Amended Report Indicator&quot;)

p3 &lt;- df %&gt;% 
  filter(!is.na(final_report_indicator)) %&gt;% 
  count(final_report_indicator) %&gt;% 
  ggplot(aes(final_report_indicator, n, fill = final_report_indicator)) +
  geom_col() +
  theme_minimal() +
  theme(legend.position = &quot;none&quot;) +
  labs(x = &quot;&quot;, title = &quot;Final Report Indicator&quot;)

p4 &lt;- df %&gt;% 
  filter(!is.na(exempt_8872_indicator)) %&gt;% 
  count(exempt_8872_indicator) %&gt;% 
  ggplot(aes(exempt_8872_indicator, n, fill = exempt_8872_indicator)) +
  geom_col() +
  theme_minimal() +
  theme(legend.position = &quot;none&quot;) +
  labs(x = &quot;&quot;, title = &quot;Exempt 8872 Indicator&quot;)

p5 &lt;- df %&gt;% 
  filter(!is.na(related_entity_bypass)) %&gt;% 
  count(related_entity_bypass) %&gt;% 
  ggplot(aes(related_entity_bypass, n, fill = related_entity_bypass)) +
  geom_col() +
  theme_minimal() +
  theme(legend.position = &quot;none&quot;) +
  labs(x = &quot;&quot;, title = &quot;Related Entity Bypass&quot;)


p6 &lt;- df %&gt;% 
  filter(!is.na(eain_bypass)) %&gt;% 
  count(eain_bypass) %&gt;% 
  ggplot(aes(eain_bypass, n, fill = eain_bypass)) +
  geom_col() +
  theme_minimal() +
  theme(legend.position = &quot;none&quot;) +
  labs(x = &quot;&quot;, title = &quot;EAIN Bypass&quot;)

(p1 + p2 + p3) / (p4 + p5 + p6)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-9-1.png" width="100%" /></p>
<pre class="r"><code>df %&gt;% 
  select(initial_report_indicator, amended_report_indicator,final_report_indicator,exempt_8872_indicator,related_entity_bypass,eain_bypass,exempt_state, business_address_state,contact_address_state,custodian_address_state,mailing_address_state) %&gt;% 
  replace_na(list(initial_report_indicator=-1, amended_report_indicator=-1,final_report_indicator=-1,exempt_8872_indicator=-1,related_entity_bypass=-1,eain_bypass=-1,exempt_state=-1, business_address_state=-1,contact_address_state=-1,custodian_address_state=-1,mailing_address_state=-1)) %&gt;%
  mutate(across(everything(), as.numeric)) %&gt;% 
  cor(use = &quot;pairwise.complete.obs&quot;, method = &quot;spearman&quot;) %&gt;% 
  corrplot(type = &quot;upper&quot;, diag = FALSE, method = &quot;square&quot;)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-10-1.png" width="100%" /></p>
</div>
<div id="directorsofficers-8871" class="section level3">
<h3>Directors/Officers (8871)</h3>
<p>These records are included with 8871 forms and shows directors and officers of the 527 organization. Of course, there can be many directors or officers in one organization.</p>
<pre class="r"><code>df &lt;- dbGetQuery(con, &#39;SELECT * FROM directors_officers_8871&#39;)</code></pre>
<pre class="r"><code>df %&gt;% 
  sample_frac(0.2) %&gt;% 
  naniar::vis_miss()</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-12-1.png" width="100%" /></p>
<p>We can take a quick look at some of the common directors/officers to see how often they show up. When we do that we see that all of the top 10 are directors/officers in over 100 entities! Itâ€™s hard to imagine that every one of these organizations is truly distinct and that they have had over 100 different distinct companies they work for. Itâ€™s possible that these are consultants that many companies hire to help with these organizations - definitely something to look into!</p>
<pre class="r"><code>df %&gt;% 
  mutate(entity_title=tolower(entity_title)) %&gt;%
  count(entity_title) %&gt;%
  arrange(desc(n)) %&gt;%
  head(20) %&gt;%
  mutate(entity_title=factor(entity_title,levels=entity_title)) %&gt;%
  ggplot(aes(entity_title, n, fill = entity_title)) +
  geom_col() +
  theme_minimal() +
  theme(legend.position = &quot;none&quot;,axis.text.x = element_text(angle = 45, vjust = 1.1, hjust=1)) +
  labs(x = &quot;&quot;, title = &quot;Director/Officer Titles (top 20)&quot;)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-13-1.png" width="100%" /></p>
</div>
<div id="related-entities-8871" class="section level3">
<h3>Related Entities (8871)</h3>
<p>These records are included with 8871 forms and showsrelated entities to the 527 organization. Of course, there can be many related entities on one form.</p>
<pre class="r"><code>df &lt;- dbGetQuery(con, &#39;SELECT * FROM related_entities_8871&#39;)</code></pre>
<pre class="r"><code>df %&gt;% 
  sample_frac(0.2) %&gt;% 
  naniar::vis_miss()</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-15-1.png" width="100%" /></p>
<pre class="r"><code>p1 &lt;- df %&gt;%
  select(entity_id,entity_name,entity_relationship,org_name) %&gt;%
  mutate(entity_name=tolower(entity_name),
         entity_relationship=tolower(entity_relationship),
         org_name=tolower(org_name)) %&gt;%
  count(entity_relationship) %&gt;%
  arrange(desc(n)) %&gt;%
  head(5) %&gt;%
  mutate(entity_relationship=factor(entity_relationship,levels=entity_relationship)) %&gt;%
  ggplot(aes(entity_relationship, n, fill = entity_relationship)) +
  geom_col() +
  theme_minimal() +
  theme(legend.position = &quot;none&quot;,axis.text.x = element_text(angle = 45, vjust = 1.1, hjust=1)) +
  labs(x = &quot;&quot;, title = &quot;Relationship Type (top 5)&quot;)


p2 &lt;- df %&gt;%
  select(ein,entity_id) %&gt;%
  group_by(ein) %&gt;%
  summarise(entity_id=n_distinct(entity_id)) %&gt;%
  arrange(desc(entity_id)) %&gt;%
  head(10) %&gt;%
  mutate(ein=factor(ein,levels=ein)) %&gt;%
  ggplot(aes(ein, entity_id, fill = ein)) +
  geom_col() +
  theme_minimal() +
  theme(legend.position = &quot;none&quot;,axis.text.x = element_text(angle = 45, vjust = 1.1, hjust=1)) +
  labs(x = &quot;EIN&quot;, y=&quot;Entitities&quot;, title = &quot;EINs with Related Entities (top 10)&quot;)

p3 &lt;- df %&gt;%
  select(form_id_number,entity_id) %&gt;%
  group_by(form_id_number) %&gt;%
  summarise(entity_cnt=n_distinct(entity_id)) %&gt;%
  group_by(entity_cnt) %&gt;%
  summarise(cnt=n_distinct(form_id_number)) %&gt;%
  ggplot(aes(entity_cnt, cnt, fill=cnt)) +
  geom_bar(stat=&#39;identity&#39;) +
  theme_minimal() +
  theme(legend.position = &quot;none&quot;) +
  labs(x = &quot;Entity Count&quot;, y=&quot;Freq&quot;, title = &quot;Distribution of Qty of Related Entities Listed on a Form&quot;) +
  facet_zoom(x=entity_cnt &lt; 5) 

(p1+p2) / p3</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-16-1.png" width="100%" /></p>
</div>
<div id="eain-8871" class="section level3">
<h3>EAIN (8871)</h3>
<p>EAIN are the Election Authority Identification numbers listed on the 8871 form.</p>
<pre class="r"><code>df &lt;- dbGetQuery(con, &#39;SELECT * FROM eain_8871&#39;)</code></pre>
<pre class="r"><code>df %&gt;% 
  select(-X6) %&gt;%
  sample_frac(0.2) %&gt;% 
  naniar::vis_miss()</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-18-1.png" width="100%" /></p>
<pre class="r"><code>df %&gt;% 
  select(state_issued) %&gt;%
  count(state_issued) %&gt;%
  arrange(desc(n)) %&gt;%
  # head(5) %&gt;%
  mutate(state_issued=factor(state_issued,levels=state_issued)) %&gt;%
  ggplot(aes(state_issued, n, fill = state_issued)) +
  geom_col() +
  theme_minimal() +
  theme(legend.position = &quot;none&quot;,axis.text.x = element_text(angle = 45, vjust = 1.1, hjust=1)) +
  labs(x = &quot;&quot;, title = &quot;State Issued&quot;)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-19-1.png" width="100%" /></p>
</div>
</div>
<div id="data-1" class="section level2 tabset tabset-fade tabset-pills">
<h2>8872 Data</h2>
<div id="main-form-1" class="section level3">
<h3>8872 Main Form</h3>
<pre class="r"><code>df &lt;- dbGetQuery(con, &#39;SELECT * FROM main_8872&#39;)</code></pre>
<pre class="r"><code>df %&gt;% 
  sample_frac(0.2) %&gt;% 
  naniar::vis_miss()</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-21-1.png" width="100%" /></p>
<pre class="r"><code>df &lt;- df %&gt;%
  select(period_begin_date,period_end_date,initial_report_indicator,amended_report_indicator,final_report_indicator,change_of_address_indicator,ein,org_formation_date,mailing_address_state,qtr_indicator,monthly_rpt_month,pre_elect_type,pre_or_post_elect_date,pre_or_post_elect_state,sched_a_ind,total_sched_a,sched_b_ind,total_sched_b)

p1 &lt;- df %&gt;% 
  filter(!is.na(initial_report_indicator)) %&gt;% 
  count(initial_report_indicator) %&gt;% 
  ggplot(aes(initial_report_indicator, n, fill = initial_report_indicator)) +
  geom_col() + theme_minimal() + theme(legend.position = &quot;none&quot;) +
  labs(x = &quot;&quot;, title = &quot;Initial Report Indicator&quot;)

p2 &lt;- df %&gt;% 
  filter(!is.na(amended_report_indicator)) %&gt;% 
  count(amended_report_indicator) %&gt;% 
  ggplot(aes(amended_report_indicator, n, fill = amended_report_indicator)) +
  geom_col() + theme_minimal() + theme(legend.position = &quot;none&quot;) +
  labs(x = &quot;&quot;, title = &quot;Amended Report Indicator&quot;)

p3 &lt;- df %&gt;% 
  filter(!is.na(final_report_indicator)) %&gt;% 
  count(final_report_indicator) %&gt;% 
  ggplot(aes(final_report_indicator, n, fill = final_report_indicator)) +
  geom_col() + theme_minimal() + theme(legend.position = &quot;none&quot;) +
  labs(x = &quot;&quot;, title = &quot;Final Report Indicator&quot;)

p4 &lt;- df %&gt;% 
  filter(!is.na(change_of_address_indicator)) %&gt;% 
  count(change_of_address_indicator) %&gt;% 
  ggplot(aes(change_of_address_indicator, n, fill = change_of_address_indicator)) +
  geom_col() + theme_minimal() + theme(legend.position = &quot;none&quot;) +
  labs(x = &quot;&quot;, title = &quot;Change of Address Indicator&quot;)

p6 &lt;- df %&gt;% 
  select(mailing_address_state) %&gt;%
  count(mailing_address_state) %&gt;%
  arrange(desc(n)) %&gt;%
  mutate(mailing_address_state=factor(mailing_address_state,levels=mailing_address_state)) %&gt;%
  ggplot(aes(mailing_address_state, n, fill = mailing_address_state)) +
  geom_col() + theme_minimal() +
  theme(legend.position = &quot;none&quot;,axis.text.x = element_text(angle = 45, vjust = 1.1, hjust=1)) +
  labs(x = &quot;&quot;, title = &quot;Mailing State&quot;)

p7 &lt;- df %&gt;% 
  filter(!is.na(sched_a_ind)) %&gt;% 
  count(sched_a_ind) %&gt;% 
  ggplot(aes(sched_a_ind, n, fill = sched_a_ind)) +
  geom_col() + theme_minimal() + theme(legend.position = &quot;none&quot;) +
  labs(x = &quot;&quot;, title = &quot;Schedule B Indicator&quot;)

p8 &lt;- df %&gt;% 
  filter(!is.na(sched_b_ind)) %&gt;% 
  count(sched_b_ind) %&gt;% 
  ggplot(aes(sched_b_ind, n, fill = sched_b_ind)) +
  geom_col() + theme_minimal() + theme(legend.position = &quot;none&quot;) +
  labs(x = &quot;&quot;, title = &quot;Schedule A Indicator&quot;)

(p1 + p2 + p3) / (p4 + p7 + p8) / (p6)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-22-1.png" width="100%" /></p>
<pre class="r"><code># df %&gt;%
#   select(total_sched_a,sched_b_ind,total_sched_b)</code></pre>
</div>
<div id="schedule-as-8872" class="section level3">
<h3>Schedule Aâ€™s (8872)</h3>
<pre class="r"><code># df &lt;- dbGetQuery(con, &#39;SELECT * FROM schedule_a_8872&#39;)</code></pre>
<pre class="r"><code># df %&gt;% 
#   sample_frac(0.01) %&gt;% 
#   naniar::vis_miss()</code></pre>
<pre class="r"><code># names(df)</code></pre>
</div>
<div id="schedule-bs-8872" class="section level3">
<h3>Schedule Bâ€™s (8872)</h3>
<pre class="r"><code># df &lt;- dbGetQuery(con, &#39;SELECT * FROM schedule_b_8872&#39;)</code></pre>
<pre class="r"><code># df %&gt;% 
#   sample_frac(0.01) %&gt;% 
#   naniar::vis_miss()</code></pre>
</div>
</div>
</div>
<div id="combined-tables-eda" class="section level1">
<h1>Combined Tables EDA</h1>
</div>
<div id="disconnect-from-the-database" class="section level1">
<h1>Disconnect from the database</h1>
<p>Always important to do!</p>
<pre class="r"><code>dbDisconnect(con)</code></pre>
</div>
